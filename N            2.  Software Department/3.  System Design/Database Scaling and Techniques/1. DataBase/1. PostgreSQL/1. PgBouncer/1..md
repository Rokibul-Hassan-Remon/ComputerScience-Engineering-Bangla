ржмрж░рзНрждржорж╛ржирзЗ рж╕рзНржХрзЗрж▓рзЗржмрж▓ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи ржЪрж╛рж▓рж╛ржирзЛ ржорж╛ржирзЗржЗ ржкрзНрж░рждрж┐ржжрж┐ржи ржирждрзБржи ржЪрзНржпрж╛рж▓рзЗржЮрзНржЬред ржЖржорж╛рж░ ржПржХржЯрж┐ рж▓рж╛ржЗржн ржЕрзНржпрж╛ржкрзЗ ржЗржЙржЬрж╛рж░ рж╕ржВржЦрзНржпрж╛ ржЫрж╛рзЬрж┐рзЯрзЗ ржЧрзЗржЫрзЗ **рзйрзл,рзжрзжрзж**, ржЖрж░ PostgreSQL ржбрзЗржЯрж╛ржмрзЗржЗржЬрзЗ ржкрзНрж░рждрж┐ рж╕рзЗржХрзЗржирзНржбрзЗ рж░рж┐ржХрзЛрзЯрзЗрж╕рзНржЯ ржпрж╛ржЪрзНржЫрзЗ **рзлрзж,рзжрзжрзж+**!

ржкрзНрж░ржержорзЗржЗ ржпрж╛ рж╣рзЯрзЗржЫрзЗ:

- ржЕрзНржпрж╛ржк рж╕рзНрж▓рзЛ рж╣рзЯрзЗ ржЧрзЗржЫрзЗ
- рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ CPU ржЖрж░ RAM рж▓рзЛржб ржмрзЗрзЬрзЗ ржЧрзЗржЫрзЗ
- ржЗржЙржЬрж╛рж░ ржПржХрзНрж╕ржкрзЗрж░рж┐рзЯрзЗржирзНрж╕ ржирж╖рзНржЯ рж╣рждрзЗ рж╢рзБрж░рзБ ржХрж░рж▓рзЛ

> ржП ржЕржмрж╕рзНржерж╛рзЯ ржЖржорж┐ ржпрзЗржЯрж╛ ржХрж░рж▓рж╛ржо тАУ рж╕рзЗржЯрж╛ ржЫрж┐рж▓ **PgBouncer** ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ PostgreSQL connection optimizationред **ржЖрж░ ржПржЗржЯрж╛ ржПржХржЯрж┐ ржЪржЯржЬрж▓ржжрж┐ рж╕ржорж╛ржзрж╛ржи ржЖржкржирж╛рж░ рж╕рзНржЯрж╛рж░рзНржЯ ржЖржк рж▓рзЗржнрзЗрж▓ ржПрж░ ржкрзНрж░рзЛржЬрзЗржХрзНржЯ ржПрж░ ржЬржирзНржп ржкрж░ржмрж░рзНрждрж┐рждрзЗ ржЖржкржирж┐ рж▓рзЛржб ржмрзНржпрж╛рж▓рзЗржирзНрж╕рж┐ржВ ржерзЗржХрзЗ рж╢рзБрж░рзБ ржХрж░рзЗ ржЕржирзЗржХ ржХрж┐ржЫрзБржЗ ржерж╛ржХржмрзЗ**

---

### ЁЯза PostgreSQL ржПрж░ ржорзВрж▓ рж╕ржорж╕рзНржпрж╛ ржХрзА?

ржкрзНрж░рждрж┐ржмрж╛рж░ ржпржЦржи ржХрзЛржи ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи PostgreSQL-ржП рж╕ржВржпрзЛржЧ ржЪрж╛рзЯ, рждржЦржи:

- ржирждрзБржи ржПржХржЯрж╛ ржкрзНрж░рж╕рзЗрж╕ рждрзИрж░рж┐ рж╣рзЯ (fork)
- ржЕржирзЗржХ ржорзЗржорзЛрж░рж┐ рж▓рж╛ржЧрзЗ (ржкрзНрж░рждрж┐ connection-ржП рзл-рззрзжMB)
- рж╕ржВржпрзЛржЧ ржЦрзБрж▓рзЗ ржЖржмрж╛рж░ ржмржирзНржз рж╣рзЯ

ржЖржкржирж┐ ржпржжрж┐ ржкрзНрж░рждрж┐ рж╕рзЗржХрзЗржирзНржбрзЗ рж╣рж╛ржЬрж╛рж░ рж╣рж╛ржЬрж╛рж░ рж░рж┐ржХрзЛрзЯрзЗрж╕рзНржЯ ржкрж╛ржарж╛ржи тАФ PostgreSQL рждрзЛ ржмрзНржпрж╕рзНржд ржерж╛ржХржмрзЗ рж╢рзБржзрзБ connection manage ржХрж░рждрзЗржЗ! ржПржЯрж╛ржЗ ржкрж╛рж░ржлрж░ржорзНржпрж╛ржирзНрж╕ ржбрзНрж░ржкрзЗрж░ ржорзВрж▓ ржХрж╛рж░ржгред

---

### тЪб рж╕ржорж╛ржзрж╛ржи: PgBouncer тАУ рж╣рж╛рж▓ржХрж╛, ржХрж┐ржирзНрждрзБ ржкрж╛ржУрзЯрж╛рж░ржлрзБрж▓

PgBouncer рж╣рж▓рзЛ ржПржХржЯрж╛ **connection pooler**, ржпрзЗржЯрж╛:

- ржПржХржмрж╛рж░ PostgreSQL-ржПрж░ рж╕рж╛ржерзЗ ржХрж┐ржЫрзБ рж╕ржВржпрзЛржЧ ржЦрзБрж▓рзЗ рж░рж╛ржЦрзЗ
- ржкрж░ржмрж░рзНрждрзА client ржЧрзБрж▓рзЛржХрзЗ рж╕рзЗржЗ рж╕ржВржпрзЛржЧ ржШрзБрж░рж┐рзЯрзЗ-ржлрж┐рж░рж┐рзЯрзЗ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ ржжрзЗрзЯ
- ржирждрзБржи ржХрж░рзЗ ржмрж╛рж░ржмрж╛рж░ рж╕ржВржпрзЛржЧ ржЦрзБрж▓рждрзЗ рж╣рзЯ ржирж╛

### рж╕рзБржмрж┐ржзрж╛:

тЬЕ ржкрзНрж░рждрж┐ рж╕ржВржпрзЛржЧрзЗ ржорж╛рждрзНрж░ рзитАУрзйKB RAM рж▓рж╛ржЧрзЗ тЬЕ PostgreSQL-ржПрж░ CPU рж▓рзЛржб ржЕржирзЗржХ ржХржорзЗ ржпрж╛рзЯ тЬЕ рж╣рж╛ржЬрж╛рж░ рж╣рж╛ржЬрж╛рж░ рж░рж┐ржХрзЛрзЯрзЗрж╕рзНржЯ рж╕рж╣ржЬрзЗ рж╣рзНржпрж╛ржирзНржбрзЗрж▓ ржХрж░рзЗ тЬЕ latency ржЕржирзЗржХ ржХржорзЗ ржпрж╛рзЯ

---

### ЁЯФз ржЖржорж╛рж░ PgBouncer ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи

```sql
max_client_conn = 50000 
default_pool_size = 200
reserve_pool_size = 50 
pool_mode = transaction
```

ржЗ рж╕рзЗржЯржЖржкрзЗрж░ ржорж╛ржзрзНржпржорзЗ PostgreSQL ржПрж░ ржЪрж╛ржк рзнрзжтАУрзорзж% ржкрж░рзНржпржирзНржд ржХржорзЗ ржЧрзЗржЫрзЗред

---

### ЁЯУЙ Prometheus/Grafana ржЫрж╛рзЬрж╛ ржХрж┐ржнрж╛ржмрзЗ ржЖржорж┐ ржоржирж┐ржЯрж░ ржХрж░рзЗржЫрж┐?

рж╕ржм рж╕ржорзЯ Prometheus ржмрж╛ Grafana рж╕рзЗржЯржЖржк ржХрж░рж╛ рж╕ржорзНржнржм рж╣рзЯ ржирж╛редржЖржорж┐ ржПржЦржиржУ рж╢рж┐ржЦрж┐ржирж╛ржЗ ред рждрж╛ржЗ ржЖржорж┐ **PgBouncer-ржПрж░ ржмрж┐рж▓рзНржЯ-ржЗржи ржХржорж╛ржирзНржб** ржжрж┐рзЯрзЗ ржЦрзБржм рж▓рж╛ржЗржЯржУрзЯрзЗржЯ ржоржирж┐ржЯрж░рж┐ржВ ржХрж░рзЗржЫрж┐:

### ЁЯзк ржоржирж┐ржЯрж░рж┐ржВ ржХржорж╛ржирзНржб:

```
psql -U postgres -h localhost -p 6432 pgbouncer 
```

ржПрж░ржкрж░ ржЪрж╛рж▓рж╛ржЗ ржирж┐ржЪрзЗрж░ ржХржорж╛ржирзНржбржЧрзБрж▓рзЛ:

ржХржорж╛ржирзНржб -------- ржХрж╛ржЬ

SHOW STATS; - ржорзЛржЯ рж░рж┐ржХрзЛрзЯрзЗрж╕рзНржЯ, latency, response time

SHOW POOLS; - ржХрзЛржи connection active, ржХрзЛржиржЯрж╛ queue-рждрзЗ

SHOW CLIENTS; - ржХрзЗ ржХрзЗ рж╕ржВржпрзБржХрзНржд

SHOW CONFIG; - ржмрж░рзНрждржорж╛ржи PgBouncer ржХржиржлрж┐ржЧ

ржПржЫрж╛рзЬрж╛ ржЖржорж┐ log_connections = 1 ржжрж┐рзЯрзЗ рж▓ржЧ ржлрж╛ржЗрж▓ ржЪрж╛рж▓рзБ рж░рзЗржЦрзЗржЫрж┐ тАФ /var/log/pgbouncer.log ржерзЗржХрзЗ ржирж┐рзЯржорж┐ржд ржмрж┐рж╢рзНрж▓рзЗрж╖ржг ржХрж░рж┐ред

---

### тЬЕ ржлрж▓рж╛ржлрж▓ (ржПржХржжржо ржкрзНрж░рзЛржбрж╛ржХрж╢ржи ржлрж┐ржбржмрзНржпрж╛ржХ)

- ЁЯУЙ Database рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ CPU usage рзмрзж% ржкрж░рзНржпржирзНржд ржХржорзЗ ржЧрзЗржЫрзЗ
- ЁЯЪА Query response time ржЕржирзЗржХ ржжрзНрж░рзБржд рж╣рзЯрзЗржЫрзЗ
- ЁЯзШтЩВя╕П PostgreSQL ржПржЦржи ржХржо рж▓рзЛржбрзЗ ржЕржирзЗржХ ржХрж╛ржЬ ржХрж░рждрзЗ ржкрж╛рж░ржЫрзЗ
- тЪЩя╕П рзлрзж,рзжрзжрзж рж░рж┐ржХрзЛрзЯрзЗрж╕рзНржЯ/рж╕рзЗржХрзЗржирзНржб ржХрзЛржирзЛ рж╕ржорж╕рзНржпрж╛ ржЫрж╛рзЬрж╛ржЗ ржЪрж▓ржЫрзЗ

---

### ЁЯУж ржнржмрж┐рж╖рзНржпрждрзЗ ржХрж┐ ржХрж░ржмрзЛ?

- Prometheus ржУ Grafana ржжрж┐рзЯрзЗ ржЖрж░ржУ ржнрж┐ржЬрзНржпрзБрзЯрж╛рж▓ ржоржирж┐ржЯрж░рж┐ржВ ржпрзЛржЧ ржХрж░ржмрзЛ
- Replica DB read/write ржЖрж▓рж╛ржжрж╛ ржХрж░ржмрзЛ
- PgBouncer cluster рждрзИрж░рж┐ ржХрж░ржмрзЛ ржмрзЬ рж▓рзЛржбрзЗрж░ ржЬржирзНржп

---

### ЁЯФЪ рж╢рзЗрж╖ ржХржерж╛

PgBouncer ржПржХржЯрж┐ ржЫрзЛржЯрзНржЯ ржЯрзБрж▓ тАФ ржХрж┐ржирзНрждрзБ ржпржжрж┐ рж╕ржарж┐ржХржнрж╛ржмрзЗ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ ржпрж╛рзЯ, рждрж╛рж╣рж▓рзЗ ржПржЯрж┐ рж╣рзЯрзЗ ржЙржарждрзЗ ржкрж╛рж░рзЗ **PostgreSQL ржкрж╛рж░ржлрж░ржорзНржпрж╛ржирзНрж╕ ржмрзБрж╕рзНржЯ ржХрж░рж╛рж░ рж╕ржмржЪрзЗрзЯрзЗ рж╕рж╣ржЬ ржУ ржХрж╛рж░рзНржпржХрж░рзА ржЙржкрж╛рзЯ**ред

**ржЖржкржирж┐ ржпржжрж┐ рж╣рж╛ржЗ-рж▓рзЛржб ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржирзЗ ржХрж╛ржЬ ржХрж░рзЗржи тАФ PgBouncer ржПржХржмрж╛рж░ ржЯрзНрж░рж╛ржЗ ржХрж░рзЗ ржжрзЗржЦрзБржиред**

[Source](https://www.linkedin.com/pulse/postgresql-%E0%A6%8F-%E0%A7%AB%E0%A7%A6%E0%A7%A6%E0%A7%A6%E0%A7%A6-%E0%A6%B0%E0%A6%95%E0%A7%9F%E0%A6%B8%E0%A6%9F%E0%A6%B8%E0%A6%95%E0%A6%A8%E0%A6%A1-%E0%A6%B9%E0%A6%AF%E0%A6%A8%E0%A6%A1%E0%A6%B2-%E0%A6%95%E0%A6%B0%E0%A6%9B-pgbouncer-%E0%A6%A6%E0%A7%9F-%E0%A6%9B%E0%A7%9C%E0%A6%93-asif-rahman-uc5dc/?trackingId=C%2FIkDcRFQKaEHS1etvkFmA%3D%3D)
